<div class="container my-5">

  <!-- Post title -->
  <h1 class="mb-4"><%= @post.title %></h1>

  <!-- Post content (INTENTIONALLY VULNERABLE) -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <!-- Stored XSS -->
      <%= @post.content.body %>
    </div>
  </div>
  <hr>

  <!-- Comments -->
  <h3 class="mb-3">Comments</h3>

  <% @post.comments.where(parent_id: nil).each do |comment| %>
    <div class="card mt-4">
      <!-- вывод комментария -->
      <div class="card-body">
        <%= comment.content.body %>
        <small>Author: <%= comment.user.email %></small>
      </div>
      <!-- Кнопка "Ответить" -->
      <button
        type="button"
        class="btn btn-link p-0"
        data-controller="reply"
        data-action="click->reply#select"
        data-reply-comment-id-value="<%= comment.id %>"
        data-reply-author-value="<%= comment.user.email %>">
        Reply
      </button>

      <!-- Вывод дочерних комментариев  -->
      <% comment.childrens.each do |child| %>
        <div class="reply" style="margin-left:20px;">
          <div class ="card-body">
            <%= child.content.body %>
          <small>Author: <%= child.user.email %></small>
          </div>
        </div>
      <% end %>
    </div>
    <% end %>

  <!-- Add comment -->
  <div class="card mt-4" id="add-comment">
    <div class="card-body">
      <h5 class="card-title mb-3">Add comment</h5>

      <%= form_with model: [@post, Comment.new], local: true do |c| %>

        <%= c.hidden_field :parent_id, id: "comment_parent_id" %>

        <div class="mb-3">
          <%= c.rich_text_area :content,
            id: "comment_content",
            placeholder: "Add your comment here..." %>
        </div>

        <%= c.submit "Add comment", class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>

